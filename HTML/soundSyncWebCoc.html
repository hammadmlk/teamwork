<!-- simultaneously play music on all devices -->
<!--  on button click send play msg to server-->
<!--  on play msg receive, play music-->

<html>
<body>

<button onclick="sendplay()">send play</button>

<audio id="audiotag1" src="sounds/classic.wav" preload="true"></audio>
<audio id="audiotag0" src="sounds/br-jam-loop.wav" preload="true"></audio>



<a href="javascript:play_single_sound();">Play 5-sec sound on single channel</a>

<p id="textmsg">loading<p>

<a href="javascript:vertogle(1);">long sound</a>
<a href="javascript:vertogle(0);">short sound</a>



<script>

    var ver=0;
    var vertogle = function(e){
        ver = e;
                
    }

    var connection = new WebSocket('ws://moodrhythm.com:8080', ['soap', 'xmpp']);
  
  
    // When the connection is open, send some data to the server
    connection.onopen = function () {
       connection.send('Ping'); // Send the message 'Ping' to the server
    };

    // Log errors
    connection.onerror = function (error) {
       console.log('WebSocket Error ' + error);
    };

    // Log messages from the server
    connection.onmessage = function (msg) {
       //var rt = Date.now() - msg.data.time
       //console.log('Roundtrip time: ' + rt + 'ms');
       console.log(msg.data);
       if (msg.data == 1){
            console.log(Date.now());
            play_single_sound();
            //console.log(Date.now());
            //
       }
       
       //connection.send(Date.now()); // Send the message 'Ping' to the server
 
    };
    
    function sendplay(){
        connection.send("play");
    }
       
    
	function play_single_sound() {
        //alert('entered3');
		
        document.getElementById('textmsg').innerHTML = "recieved";
        
        if (ver == 1){
            document.getElementById('audiotag1').play();
        }
        else{
            document.getElementById('audiotag0').play();
        }
	}

    var audioReady = function(){
        if (document.getElementById('audiotag0').readyState) {
            document.getElementById('textmsg').innerHTML = "music loaded";
            
        } else {
            setTimeout(audioReady, 250);
            var v= document.getElementById('textmsg').innerHTML;
            document.getElementById('textmsg').innerHTML = v+".";
           
        }
    }
    audioReady();
    

  
</script>
</body>
</html>